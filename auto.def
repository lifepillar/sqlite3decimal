use cc cc-shared

options {
}

define NAME "sqlite3decimal"
define VERSION "0.0.1"

switch -glob -- [lindex [split [get-define host] -] end] {
  darwin* {
    define host_os darwin
    define LDFLAGS -dynamiclib
  }
  default {
    define host_os other
    define LDFLAGS -shared
  }
}

if {[opt-bool debug]} {
  define CFLAGS {-g -O0}
  define-append CFLAGS -DDEBUG
  define DECFLAGS {-DDECPRINT=1 -DDECCHECK=1 -DDECALLOC=1}
  msg-result "Debugging support enabled"
} else {
  define CFLAGS {-Os}
  define-append CFLAGS -DNDEBUG
  define DECFLAGS {-DDECPRINT=0 -DDECCHECK=0 -DDECALLOC=0}
}
define EXTRA_CFLAGS {-fPIC -Wall -Wextra}

#cc-check-endian
cc-check-tools ar ranlib strip

cc-with {-includes {stdint.h inttypes.h}} {
  cc-check-types uint32_t uint16_t int16_t uint8_t
}

make-config-header autoconfig.h
make-template Makefile.in

